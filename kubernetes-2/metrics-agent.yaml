apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: metrics-agent
  namespace: default
spec:
  destination:
    name: ''
    namespace: grafana
    server: 'https://kubernetes.default.svc'
  source:
    path: ''
    repoURL: 'https://grafana.github.io/helm-charts'
    targetRevision: 0.10.0
    chart: grafana-agent
    helm:
      values: |
        fullnameOverride: metrics-agent
        agent:
          mode: 'static'
          content: |
            metrics:
              wal_directory: /var/lib/agent/wal
              global:
                scrape_interval: 60s
                external_labels:
                  cluster: cloud
              configs:
              - name: integrations
                remote_write:
                - url: https://prometheus-prod-26-prod-ap-south-0.grafana.net/api/prom/push
                  basic_auth:
                    username: 946653
                    password: eyJrIjoiNjZhYTQxMGQzYjQzMTNkODg5MjBiNTBiY2FkM2NmOTU4YWQ0ODMyNiIsIm4iOiJzdGFjay02MjI4OTctZWFzeXN0YXJ0LXByb20tcHVibGlzaGVyIiwiaWQiOjY1Mjk5Mn0=
                scrape_configs:
                - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                  job_name: integrations/kubernetes/cadvisor
                  kubernetes_sd_configs:
                      - role: node
                  metric_relabel_configs:
                      - source_labels: [__name__]
                        regex: kubelet_pleg_relist_duration_seconds_bucket|kube_daemonset_status_current_number_scheduled|kube_horizontalpodautoscaler_status_current_replicas|kube_node_status_condition|kube_statefulset_status_current_revision|container_fs_writes_total|storage_operation_duration_seconds_count|namespace_memory:kube_pod_container_resource_requests:sum|kube_deployment_status_replicas_updated|kube_horizontalpodautoscaler_status_desired_replicas|kube_statefulset_status_update_revision|container_fs_reads_bytes_total|kubelet_pod_worker_duration_seconds_bucket|kube_pod_status_phase|cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests|container_network_receive_packets_dropped_total|kubelet_cgroup_manager_duration_seconds_count|kube_daemonset_status_updated_number_scheduled|kube_statefulset_replicas|kubelet_certificate_manager_server_ttl_seconds|kubelet_volume_stats_capacity_bytes|kube_pod_container_resource_limits|kube_pod_owner|kubelet_server_expiration_renew_errors|kube_replicaset_owner|kube_node_status_capacity|container_memory_swap|kube_namespace_status_phase|container_cpu_cfs_periods_total|node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate|kubelet_runtime_operations_errors_total|kube_statefulset_metadata_generation|machine_memory_bytes|process_resident_memory_bytes|kube_job_failed|kubernetes_build_info|kube_deployment_status_observed_generation|container_network_receive_bytes_total|kubelet_node_name|kube_deployment_spec_replicas|kube_persistentvolumeclaim_resource_requests_storage_bytes|kube_pod_container_status_waiting_reason|node_filesystem_avail_bytes|container_network_transmit_packets_dropped_total|container_cpu_cfs_throttled_periods_total|kubelet_running_containers|namespace_cpu:kube_pod_container_resource_limits:sum|cluster:namespace:pod_memory:active:kube_pod_container_resource_requests|storage_operation_errors_total|kubelet_pleg_relist_duration_seconds_count|kubelet_volume_stats_available_bytes|kubelet_runtime_operations_total|kubelet_cgroup_manager_duration_seconds_bucket|kubelet_certificate_manager_client_expiration_renew_errors|kube_node_spec_taint|container_fs_writes_bytes_total|kube_horizontalpodautoscaler_spec_min_replicas|container_memory_working_set_bytes|node_namespace_pod_container:container_memory_working_set_bytes|kube_daemonset_status_number_misscheduled|kubelet_pleg_relist_interval_seconds_bucket|rest_client_requests_total|kubelet_volume_stats_inodes_used|kube_daemonset_status_desired_number_scheduled|cluster:namespace:pod_memory:active:kube_pod_container_resource_limits|container_network_transmit_packets_total|namespace_cpu:kube_pod_container_resource_requests:sum|kube_pod_info|namespace_workload_pod|kube_job_status_start_time|container_network_receive_packets_total|kube_statefulset_status_replicas_updated|kubelet_volume_stats_inodes|kube_job_status_active|node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile|container_memory_cache|kubelet_running_pod_count|node_namespace_pod_container:container_memory_cache|container_memory_rss|kubelet_running_pods|node_namespace_pod_container:container_memory_swap|kube_statefulset_status_replicas|cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits|kube_pod_container_resource_requests|kubelet_node_config_error|kubelet_pod_start_duration_seconds_count|kubelet_pod_worker_duration_seconds_count|kube_node_info|node_filesystem_size_bytes|namespace_workload_pod:kube_pod_owner:relabel|namespace_memory:kube_pod_container_resource_limits:sum|kube_statefulset_status_observed_generation|kube_daemonset_status_number_available|kube_resourcequota|kube_deployment_metadata_generation|kube_deployment_status_replicas_available|kubelet_certificate_manager_client_ttl_seconds|kubelet_running_container_count|kube_horizontalpodautoscaler_spec_max_replicas|container_fs_reads_total|process_cpu_seconds_total|node_namespace_pod_container:container_memory_rss|go_goroutines|kube_node_status_allocatable|kube_pod_status_reason|container_network_transmit_bytes_total|kubelet_pod_start_duration_seconds_bucket|volume_manager_total_volumes|kube_statefulset_status_replicas_ready|container_cpu_usage_seconds_total|kube_namespace_status_phase|container_cpu_usage_seconds_total|kube_pod_status_phase|kube_pod_start_time|kube_pod_container_status_restarts_total|kube_pod_container_info|kube_pod_container_status_waiting_reason|kube_daemonset.*|kube_replicaset.*|kube_statefulset.*|kube_job.*|kube_node.*|node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate|cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests|namespace_cpu:kube_pod_container_resource_requests:sum|node_cpu.*|node_memory.*|node_filesystem.*
                        action: keep
                  relabel_configs:
                      - replacement: kubernetes.default.svc.cluster.local:443
                        target_label: __address__
                      - regex: (.+)
                        replacement: /api/v1/nodes/${1}/proxy/metrics/cadvisor
                        source_labels:
                          - __meta_kubernetes_node_name
                        target_label: __metrics_path__
                  scheme: https
                  tls_config:
                      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                      insecure_skip_verify: false
                      server_name: kubernetes
                - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                  job_name: integrations/kubernetes/kubelet
                  kubernetes_sd_configs:
                      - role: node
                  metric_relabel_configs:
                      - source_labels: [__name__]
                        regex: kubelet_pleg_relist_duration_seconds_bucket|kube_daemonset_status_current_number_scheduled|kube_horizontalpodautoscaler_status_current_replicas|kube_node_status_condition|kube_statefulset_status_current_revision|container_fs_writes_total|storage_operation_duration_seconds_count|namespace_memory:kube_pod_container_resource_requests:sum|kube_deployment_status_replicas_updated|kube_horizontalpodautoscaler_status_desired_replicas|kube_statefulset_status_update_revision|container_fs_reads_bytes_total|kubelet_pod_worker_duration_seconds_bucket|kube_pod_status_phase|cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests|container_network_receive_packets_dropped_total|kubelet_cgroup_manager_duration_seconds_count|kube_daemonset_status_updated_number_scheduled|kube_statefulset_replicas|kubelet_certificate_manager_server_ttl_seconds|kubelet_volume_stats_capacity_bytes|kube_pod_container_resource_limits|kube_pod_owner|kubelet_server_expiration_renew_errors|kube_replicaset_owner|kube_node_status_capacity|container_memory_swap|kube_namespace_status_phase|container_cpu_cfs_periods_total|node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate|kubelet_runtime_operations_errors_total|kube_statefulset_metadata_generation|machine_memory_bytes|process_resident_memory_bytes|kube_job_failed|kubernetes_build_info|kube_deployment_status_observed_generation|container_network_receive_bytes_total|kubelet_node_name|kube_deployment_spec_replicas|kube_persistentvolumeclaim_resource_requests_storage_bytes|kube_pod_container_status_waiting_reason|node_filesystem_avail_bytes|container_network_transmit_packets_dropped_total|container_cpu_cfs_throttled_periods_total|kubelet_running_containers|namespace_cpu:kube_pod_container_resource_limits:sum|cluster:namespace:pod_memory:active:kube_pod_container_resource_requests|storage_operation_errors_total|kubelet_pleg_relist_duration_seconds_count|kubelet_volume_stats_available_bytes|kubelet_runtime_operations_total|kubelet_cgroup_manager_duration_seconds_bucket|kubelet_certificate_manager_client_expiration_renew_errors|kube_node_spec_taint|container_fs_writes_bytes_total|kube_horizontalpodautoscaler_spec_min_replicas|container_memory_working_set_bytes|node_namespace_pod_container:container_memory_working_set_bytes|kube_daemonset_status_number_misscheduled|kubelet_pleg_relist_interval_seconds_bucket|rest_client_requests_total|kubelet_volume_stats_inodes_used|kube_daemonset_status_desired_number_scheduled|cluster:namespace:pod_memory:active:kube_pod_container_resource_limits|container_network_transmit_packets_total|namespace_cpu:kube_pod_container_resource_requests:sum|kube_pod_info|namespace_workload_pod|kube_job_status_start_time|container_network_receive_packets_total|kube_statefulset_status_replicas_updated|kubelet_volume_stats_inodes|kube_job_status_active|node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile|container_memory_cache|kubelet_running_pod_count|node_namespace_pod_container:container_memory_cache|container_memory_rss|kubelet_running_pods|node_namespace_pod_container:container_memory_swap|kube_statefulset_status_replicas|cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits|kube_pod_container_resource_requests|kubelet_node_config_error|kubelet_pod_start_duration_seconds_count|kubelet_pod_worker_duration_seconds_count|kube_node_info|node_filesystem_size_bytes|namespace_workload_pod:kube_pod_owner:relabel|namespace_memory:kube_pod_container_resource_limits:sum|kube_statefulset_status_observed_generation|kube_daemonset_status_number_available|kube_resourcequota|kube_deployment_metadata_generation|kube_deployment_status_replicas_available|kubelet_certificate_manager_client_ttl_seconds|kubelet_running_container_count|kube_horizontalpodautoscaler_spec_max_replicas|container_fs_reads_total|process_cpu_seconds_total|node_namespace_pod_container:container_memory_rss|go_goroutines|kube_node_status_allocatable|kube_pod_status_reason|container_network_transmit_bytes_total|kubelet_pod_start_duration_seconds_bucket|volume_manager_total_volumes|kube_statefulset_status_replicas_ready|container_cpu_usage_seconds_total|kube_namespace_status_phase|container_cpu_usage_seconds_total|kube_pod_status_phase|kube_pod_start_time|kube_pod_container_status_restarts_total|kube_pod_container_info|kube_pod_container_status_waiting_reason|kube_daemonset.*|kube_replicaset.*|kube_statefulset.*|kube_job.*|kube_node.*|node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate|cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests|namespace_cpu:kube_pod_container_resource_requests:sum|node_cpu.*|node_memory.*|node_filesystem.*
                        action: keep
                  relabel_configs:
                      - replacement: kubernetes.default.svc.cluster.local:443
                        target_label: __address__
                      - regex: (.+)
                        replacement: /api/v1/nodes/${1}/proxy/metrics
                        source_labels:
                          - __meta_kubernetes_node_name
                        target_label: __metrics_path__
                  scheme: https
                  tls_config:
                      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                      insecure_skip_verify: false
                      server_name: kubernetes
                - job_name: integrations/kubernetes/kube-state-metrics
                  kubernetes_sd_configs:
                      - role: pod
                  metric_relabel_configs:
                      - source_labels: [__name__]
                        regex: kubelet_pleg_relist_duration_seconds_bucket|kube_daemonset_status_current_number_scheduled|kube_horizontalpodautoscaler_status_current_replicas|kube_node_status_condition|kube_statefulset_status_current_revision|container_fs_writes_total|storage_operation_duration_seconds_count|namespace_memory:kube_pod_container_resource_requests:sum|kube_deployment_status_replicas_updated|kube_horizontalpodautoscaler_status_desired_replicas|kube_statefulset_status_update_revision|container_fs_reads_bytes_total|kubelet_pod_worker_duration_seconds_bucket|kube_pod_status_phase|cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests|container_network_receive_packets_dropped_total|kubelet_cgroup_manager_duration_seconds_count|kube_daemonset_status_updated_number_scheduled|kube_statefulset_replicas|kubelet_certificate_manager_server_ttl_seconds|kubelet_volume_stats_capacity_bytes|kube_pod_container_resource_limits|kube_pod_owner|kubelet_server_expiration_renew_errors|kube_replicaset_owner|kube_node_status_capacity|container_memory_swap|kube_namespace_status_phase|container_cpu_cfs_periods_total|node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate|kubelet_runtime_operations_errors_total|kube_statefulset_metadata_generation|machine_memory_bytes|process_resident_memory_bytes|kube_job_failed|kubernetes_build_info|kube_deployment_status_observed_generation|container_network_receive_bytes_total|kubelet_node_name|kube_deployment_spec_replicas|kube_persistentvolumeclaim_resource_requests_storage_bytes|kube_pod_container_status_waiting_reason|node_filesystem_avail_bytes|container_network_transmit_packets_dropped_total|container_cpu_cfs_throttled_periods_total|kubelet_running_containers|namespace_cpu:kube_pod_container_resource_limits:sum|cluster:namespace:pod_memory:active:kube_pod_container_resource_requests|storage_operation_errors_total|kubelet_pleg_relist_duration_seconds_count|kubelet_volume_stats_available_bytes|kubelet_runtime_operations_total|kubelet_cgroup_manager_duration_seconds_bucket|kubelet_certificate_manager_client_expiration_renew_errors|kube_node_spec_taint|container_fs_writes_bytes_total|kube_horizontalpodautoscaler_spec_min_replicas|container_memory_working_set_bytes|node_namespace_pod_container:container_memory_working_set_bytes|kube_daemonset_status_number_misscheduled|kubelet_pleg_relist_interval_seconds_bucket|rest_client_requests_total|kubelet_volume_stats_inodes_used|kube_daemonset_status_desired_number_scheduled|cluster:namespace:pod_memory:active:kube_pod_container_resource_limits|container_network_transmit_packets_total|namespace_cpu:kube_pod_container_resource_requests:sum|kube_pod_info|namespace_workload_pod|kube_job_status_start_time|container_network_receive_packets_total|kube_statefulset_status_replicas_updated|kubelet_volume_stats_inodes|kube_job_status_active|node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile|container_memory_cache|kubelet_running_pod_count|node_namespace_pod_container:container_memory_cache|container_memory_rss|kubelet_running_pods|node_namespace_pod_container:container_memory_swap|kube_statefulset_status_replicas|cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits|kube_pod_container_resource_requests|kubelet_node_config_error|kubelet_pod_start_duration_seconds_count|kubelet_pod_worker_duration_seconds_count|kube_node_info|node_filesystem_size_bytes|namespace_workload_pod:kube_pod_owner:relabel|namespace_memory:kube_pod_container_resource_limits:sum|kube_statefulset_status_observed_generation|kube_daemonset_status_number_available|kube_resourcequota|kube_deployment_metadata_generation|kube_deployment_status_replicas_available|kubelet_certificate_manager_client_ttl_seconds|kubelet_running_container_count|kube_horizontalpodautoscaler_spec_max_replicas|container_fs_reads_total|process_cpu_seconds_total|node_namespace_pod_container:container_memory_rss|go_goroutines|kube_node_status_allocatable|kube_pod_status_reason|container_network_transmit_bytes_total|kubelet_pod_start_duration_seconds_bucket|volume_manager_total_volumes|kube_statefulset_status_replicas_ready|container_cpu_usage_seconds_total|kube_namespace_status_phase|container_cpu_usage_seconds_total|kube_pod_status_phase|kube_pod_start_time|kube_pod_container_status_restarts_total|kube_pod_container_info|kube_pod_container_status_waiting_reason|kube_daemonset.*|kube_replicaset.*|kube_statefulset.*|kube_job.*|kube_node.*|node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate|cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests|namespace_cpu:kube_pod_container_resource_requests:sum|node_cpu.*|node_memory.*|node_filesystem.*
                        action: keep
                  relabel_configs:
                      - action: keep
                        regex: kube-state-metrics
                        source_labels:
                          - __meta_kubernetes_pod_label_app_kubernetes_io_name
                - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                  job_name: integrations/node_exporter
                  kubernetes_sd_configs:
                      - namespaces:
                          names:
                              - default
                        role: pod
                  metric_relabel_configs:
                      - source_labels: [__name__]
                        regex: kubelet_pleg_relist_duration_seconds_bucket|kube_daemonset_status_current_number_scheduled|kube_horizontalpodautoscaler_status_current_replicas|kube_node_status_condition|kube_statefulset_status_current_revision|container_fs_writes_total|storage_operation_duration_seconds_count|namespace_memory:kube_pod_container_resource_requests:sum|kube_deployment_status_replicas_updated|kube_horizontalpodautoscaler_status_desired_replicas|kube_statefulset_status_update_revision|container_fs_reads_bytes_total|kubelet_pod_worker_duration_seconds_bucket|kube_pod_status_phase|cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests|container_network_receive_packets_dropped_total|kubelet_cgroup_manager_duration_seconds_count|kube_daemonset_status_updated_number_scheduled|kube_statefulset_replicas|kubelet_certificate_manager_server_ttl_seconds|kubelet_volume_stats_capacity_bytes|kube_pod_container_resource_limits|kube_pod_owner|kubelet_server_expiration_renew_errors|kube_replicaset_owner|kube_node_status_capacity|container_memory_swap|kube_namespace_status_phase|container_cpu_cfs_periods_total|node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate|kubelet_runtime_operations_errors_total|kube_statefulset_metadata_generation|machine_memory_bytes|process_resident_memory_bytes|kube_job_failed|kubernetes_build_info|kube_deployment_status_observed_generation|container_network_receive_bytes_total|kubelet_node_name|kube_deployment_spec_replicas|kube_persistentvolumeclaim_resource_requests_storage_bytes|kube_pod_container_status_waiting_reason|node_filesystem_avail_bytes|container_network_transmit_packets_dropped_total|container_cpu_cfs_throttled_periods_total|kubelet_running_containers|namespace_cpu:kube_pod_container_resource_limits:sum|cluster:namespace:pod_memory:active:kube_pod_container_resource_requests|storage_operation_errors_total|kubelet_pleg_relist_duration_seconds_count|kubelet_volume_stats_available_bytes|kubelet_runtime_operations_total|kubelet_cgroup_manager_duration_seconds_bucket|kubelet_certificate_manager_client_expiration_renew_errors|kube_node_spec_taint|container_fs_writes_bytes_total|kube_horizontalpodautoscaler_spec_min_replicas|container_memory_working_set_bytes|node_namespace_pod_container:container_memory_working_set_bytes|kube_daemonset_status_number_misscheduled|kubelet_pleg_relist_interval_seconds_bucket|rest_client_requests_total|kubelet_volume_stats_inodes_used|kube_daemonset_status_desired_number_scheduled|cluster:namespace:pod_memory:active:kube_pod_container_resource_limits|container_network_transmit_packets_total|namespace_cpu:kube_pod_container_resource_requests:sum|kube_pod_info|namespace_workload_pod|kube_job_status_start_time|container_network_receive_packets_total|kube_statefulset_status_replicas_updated|kubelet_volume_stats_inodes|kube_job_status_active|node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile|container_memory_cache|kubelet_running_pod_count|node_namespace_pod_container:container_memory_cache|container_memory_rss|kubelet_running_pods|node_namespace_pod_container:container_memory_swap|kube_statefulset_status_replicas|cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits|kube_pod_container_resource_requests|kubelet_node_config_error|kubelet_pod_start_duration_seconds_count|kubelet_pod_worker_duration_seconds_count|kube_node_info|node_filesystem_size_bytes|namespace_workload_pod:kube_pod_owner:relabel|namespace_memory:kube_pod_container_resource_limits:sum|kube_statefulset_status_observed_generation|kube_daemonset_status_number_available|kube_resourcequota|kube_deployment_metadata_generation|kube_deployment_status_replicas_available|kubelet_certificate_manager_client_ttl_seconds|kubelet_running_container_count|kube_horizontalpodautoscaler_spec_max_replicas|container_fs_reads_total|process_cpu_seconds_total|node_namespace_pod_container:container_memory_rss|go_goroutines|kube_node_status_allocatable|kube_pod_status_reason|container_network_transmit_bytes_total|kubelet_pod_start_duration_seconds_bucket|volume_manager_total_volumes|kube_statefulset_status_replicas_ready|container_cpu_usage_seconds_total|kube_namespace_status_phase|container_cpu_usage_seconds_total|kube_pod_status_phase|kube_pod_start_time|kube_pod_container_status_restarts_total|kube_pod_container_info|kube_pod_container_status_waiting_reason|kube_daemonset.*|kube_replicaset.*|kube_statefulset.*|kube_job.*|kube_node.*|node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate|cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests|namespace_cpu:kube_pod_container_resource_requests:sum|node_cpu.*|node_memory.*|node_filesystem.*
                        action: keep
                  relabel_configs:
                      - action: keep
                        regex: prometheus-node-exporter.*
                        source_labels:
                          - __meta_kubernetes_pod_label_app_kubernetes_io_name
                      - action: replace
                        source_labels:
                          - __meta_kubernetes_pod_node_name
                        target_label: instance
                      - action: replace
                        source_labels:
                          - __meta_kubernetes_namespace
                        target_label: namespace
                  tls_config:
                      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                      insecure_skip_verify: false
                
            integrations:
              eventhandler:
                cache_path: /var/lib/agent/eventhandler.cache
                logs_instance: integrations
            logs:
              configs:
              - name: integrations
                clients:
                - url: https://logs-prod-014.grafana.net/loki/api/v1/push
                  basic_auth:
                    username: 472295
                    password: eyJrIjoiNjZhYTQxMGQzYjQzMTNkODg5MjBiNTBiY2FkM2NmOTU4YWQ0ODMyNiIsIm4iOiJzdGFjay02MjI4OTctZWFzeXN0YXJ0LXByb20tcHVibGlzaGVyIiwiaWQiOjY1Mjk5Mn0=
                  external_labels:
                    cluster: cloud
                    job: integrations/kubernetes/eventhandler
                positions:
                  filename: /tmp/positions.yaml
                target_config:
                  sync_period: 10s
  sources: []
  project: default
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    retry:
      limit: 2
      backoff:
        duration: 5s
        maxDuration: 3m0s
        factor: 2
    syncOptions:
      - CreateNamespace=true